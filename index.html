<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2>甲烷浓度分布</h2>
    <p>参考文献：文献</p>
</body>

<!DOCTYPE html>
<html>
<head>
    <title>Leaflet with GeoJSON</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 引入Leaflet的CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- 隐藏Leaflet图标和文字 -->
    <style>
        #mapid { height: 600px; }
        .leaflet-control-attribution {
            display: none;
        }
        /* 设置地图的深色底图样式 */
        .leaflet-container {
            background: #767272;
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <!-- 引入Leaflet的JavaScript -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>      
    <script>
        // 创建地图实例，并设置视图到世界地图的中心点，缩放级别为2
        var map = L.map('mapid').setView([30, 0], 2);

        // 加载world.zh.geojson作为底图
        fetch('https://hanzzz2020.github.io/CH4_mapping/world.zh.geojson')   
            .then(response => response.json())
            .then(data => {
                // 创建GeoJSON图层并添加到地图
                var worldLayer = L.geoJSON(data, {
                    style: function (feature) {
                        return {
                            color: "#000000", // 边界颜色
                            weight: 1,
                            opacity: 1,
                            fillColor: '#000000', // 填充颜色
                            fillOpacity: 1 // 完全不透明
                        };
                    }
                }).addTo(map);
            })
            .catch(error => {
                console.error('Error loading world.zh.geojson:', error);
            });
            
        // 加载InlandWater_data.geojson点数据
        fetch('https://hanzzz2020.github.io/CH4_mapping/InlandWater_data.geojson')   
            .then(response => response.json())
            .then(data => {
                // 创建GeoJSON图层并添加到地图
                var inlandWaterLayer = L.geoJSON(data, {
                    pointToLayer: function (feature, latlng) {
                        var fluxMean = feature.properties.Flux_Mean;
                        var color = getColor(fluxMean);
                        return L.circleMarker(latlng, {
                            radius: 6,
                            fillColor: color,
                            color: color,
                            weight: 1,
                            opacity: 1,
                            fillOpacity: 0.8
                        });
                    },
                    onEachFeature: function (feature, layer) {
                        // 为每个特征添加悬停和点击事件
                        if (feature.properties) {
                            var tooltipContent = `Concen Mean: ${feature.properties.Concen_Mean}<br>Concen Range: ${feature.properties.Concen_Range}`;
                            var popupContent = `Concen Mean: ${feature.properties.Concen_Mean}<br>Concen Range: ${feature.properties.Concen_Range}`;
                            
                            layer.bindTooltip(tooltipContent, { permanent: false, sticky: false });
                            layer.on('click', function(e) {
                                if (e.target._popup) {
                                    e.target.unbindPopup();
                                } else {
                                    e.target.bindPopup(popupContent).openPopup();
                                }
                            });
                        }
                    }
                }).addTo(map);

                // 确保点数据图层在面数据图层之上
                map.addLayer(inlandWaterLayer);
                map.removeLayer(worldLayer);
                map.addLayer(worldLayer);
            })
            .catch(error => {
                console.error('Error loading InlandWater_data.geojson:', error);
            });

        // 根据甲烷浓度值返回颜色
        function getColor(fluxMean) {
            var min = 0; // 最小浓度值
            var max = 100; // 最大浓度值，根据实际情况调整
            var ratio = (fluxMean - min) / (max - min);
            var r, g, b;
            if (ratio < 0.001) {
                // Red to Orange
                r = 255;
                g = Math.round(255 * (ratio / 0.2));
                b = 0;
            } else if (ratio < 0.005) {
                // Orange to Yellow
                r = 255;
                g = 255;
                b = Math.round(255 * ((ratio - 0.2) / 0.2));
            } else if (ratio < 0.1) {
                // Yellow to Green
                r = Math.round(255 - (255 * ((ratio - 0.4) / 0.2)));
                g = 255;
                b = 0;
            } else if (ratio < 0.5) {
                // Green to Blue
                r = 0;
                g = Math.round(255 - (255 * ((ratio - 0.6) / 0.2)));
                b = Math.round(255 * ((ratio - 0.6) / 0.2));
            } else {
                // Light Blue
                r = 0; // Light Blue shade
                g = 122; // Light Blue shade
                b = 255; // Light Blue shade
            }
            return `rgb(${r},${g},${b})`;
        }

    </script>
</body>
</html>
